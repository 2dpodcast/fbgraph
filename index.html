<!DOCTYPE html>
<html>
  <head>
    <title>FBGraph - Stay classy facebook</title>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div id="content">
<h1>It's the Facebook Graph, Bro!</h1>

<p><a href="http://github.com/criso/fbgraph">FBgraph</a> is a nodejs module that provides easy access to the facebook graph api</p>

<h2>Oh nooooooesss - MOAR facebook</h2>

<p>I created this, because I wanted to access FB's graph from <code>node</code>. <br />
  The libraries I found, felt clunky to me, and I needed an excuse to create a node module.</p>

<p>All calls will return <code>json</code>. Facebook sometimes (on friend requests, deleting test users, access token request) <br />
  decides to just return a <code>string</code> or <code>true</code> or redirects directly to the image. I say <strong>nay-nay</strong>! Let's make it Disney, and keep things consistent! </p>

<h2>Installation via npm</h2>

<pre><code>$ npm install fbgraph

var graph = require('fbgraph');
</code></pre>

<h2>Authentication</h2>

<p>If you get an accesstoken via some other Oauth module like <a href="https://github.com/bnoguchi/everyauth">everyauth</a> , 
<a href="https://github.com/ciaranj/connect-auth">connect-auth</a> or <a href="https://github.com/ciaranj/node-oauth">node-oauth</a> you can just set <br />
the access token directly. Most <code>get</code> calls, and pretty much all <code>post</code> calls will require an <code>access_token</code></p>

<pre><code>graph.setAccessToken(access_token);
</code></pre>

<p>This is how you would get authenticated using only the <code>fbgraph</code> module.
More details below on the <strong>express app</strong> section</p>

<pre><code>// get authorization url
var authUrl = graph.getOauthUrl({
  "client_id":       conf.client_id
  , "redirect_uri":  conf.redirect_uri
});

// shows dialog
res.redirect(authUrl);

// after user click, auth `code` will be set
// we'll send that and get the access token
graph.authorize({
    "client_id":        conf.client_id
  , "redirect_uri":   conf.redirect_uri
  , "client_secret":  conf.client_secret
  , "code":           req.query.code
}, function (err, facebookRes) {
  res.redirect('/loggedIn');
});
</code></pre>

<h2>Read data from the Graph Api</h2>

<pre><code>graph.get("zuck", function(err, res) {
  console.log(res); // { id: '4', name: 'Mark Zuckerberg'... }
});
</code></pre>

<p>params in the <code>url</code></p>

<pre><code>graph.get("zuck?fields=picture", function(err, res) {
  console.log(res); // { picture: 'http://profile.ak.fbcdn.net/'... }
});
</code></pre>

<p>params as an <code>object</code></p>

<pre><code>var params = { fields: picture };

graph.get("zuck", params,  function(err, res) {
  console.log(res); // { picture: "http://profile.ak.fbcdn.net/..." }
});
</code></pre>

<p>GraphApi calls that redirect directly to an image
will return a json response with relevant fields</p>

<pre><code>graph.get("/zuck/picture", function(err, res) {
  console.log(res); // { image: true, location: "http://profile.ak.fb..." }
});
</code></pre>

<h2>Search data from the Graph Api</h2>

<p>Search for public posts that contain <strong>brogramming</strong></p>

<pre><code>var searchOptions = {
    q:     "brogramming"
  , type:  "post"
};

graph.search(searchOptions, function(err, res) {
  console.log(res); // {data: [{id: xxx, from: ...}, {id: xxx, from: ...}]}
});
</code></pre>

<h2>Publish data to the Graph Api</h2>

<p>All publish requests will require an <code>access token</code></p>

<p>only needs to be set once</p>

<pre><code>graph.setAccessToken(accessToken);
</code></pre>

<p>Post a message on a <code>friend's</code> wall</p>

<pre><code>var wallPost = {
  message: "I'm gonna come at you like a spider monkey, chip!"
};

graph.post(userId + "/feed", wallPost, function(err, res) {
  // returns the post id
  console.log(res); // { id: xxxxx}
});
</code></pre>

<h2>Delete a Graph object</h2>

<p>To delete a graph object, provide an <code>object id</code> and the 
response will return <code>true</code> or <code>false</code></p>

<pre><code>graph.del(postID, function(err, res) {
  console.log(res); // true/false
});
</code></pre>

<h2>Rockin' it on an Express App</h2>

<p>This example assumes that you have a link on the main page <code>/</code> that points to <code>/auth/facebook</code>. <br />
The user will click this link and get into the facebook authorization flow ( if the user hasn't already connected) <br />
After <code>authorizing</code> the app the user will be redirected to <code>/UserHasLoggedIn</code>  </p>

<pre><code>/**
 * Module dependencies.
 */

var express   = require('express')
, graph     = require('fbgraph')
, app       = module.exports = express.createServer();

// this should really be in a config file!
var conf = {
  client_id:        'YOUR FACEBOOK APP ID'
  , client_secret:  'YOU FACEBOOK APP SECRET'
  , scope:          'email, user_about_me, user_birthday, user_location, publish_stream'
  , redirect_uri:   'http://localhost:3000/auth/facebook'
};

// Configuration

app.configure(function(){
  app.set('views', __dirname + '/views');
  app.set('view engine', 'jade');
  app.use(express.bodyParser());
  app.use(express.methodOverride());
  app.use(app.router);
  app.use(express.static(__dirname + '/public'));
});

app.configure('development', function(){
  app.use(express.errorHandler({ dumpExceptions: true, showStack: true })); 
});

app.configure('production', function(){
  app.use(express.errorHandler());
});

// Routes

app.get('/', function(req, res){
  res.render("index", { title: "click link to connect" });
});

app.get('/auth/facebook', function(req, res) {

  // we don't have a code yet
  // so we'll redirect to the oauth dialog
  if (!req.query.code) {
    var authUrl = graph.getOauthUrl({
      "client_id":       conf.client_id
      , "redirect_uri":  conf.redirect_uri
    });

    res.redirect(authUrl);

    return;
  }

  // auth `code` is set
  // we'll send that and get the access token
  graph.authorize({
    "client_id":        conf.client_id
    , "redirect_uri":   conf.redirect_uri
    , "client_secret":  conf.client_secret
    , "code":           req.query.code
  }, function (err, facebookRes) {
    res.redirect('/loggedIn');
  });

});

// user gets sent here after being authorized
app.get('/UserHasLoggedIn', function(req, res) {
  res.render("index", { title: "Logged In" });
});


var port = process.env.PORT || 3000;
app.listen(port, function() {
  console.log("Express server listening on port %d", port);
});
</code></pre>

<h2>Running tests</h2>

<p>Before running the test suite, add your Facebook <code>appId</code> and <code>appSecret</code> to <code>tests/config.js</code> <br />
 This is needed to create <code>test users</code> and to get a test <code>access_token</code></p>

<pre><code>$ npm install
$ make test
</code></pre>

<p><em>Tests might fail if the Facebook api has an issue.</em></p>
	</div>
	<a href="http://github.com/criso/fbgraph"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/e6bef7a091f5f3138b8cd40bc3e114258dd68ddf/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub"></a>


	<script src="js/hijs.js"></script>
	
  </body>
</html>
